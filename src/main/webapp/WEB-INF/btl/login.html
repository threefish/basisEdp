<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>${i18n.loginBoxTitle}</title>
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <%if(so.isAuthenticated()){%>
    <script type="text/javascript">
        window.location.href = "${base!}/main/indx"
    </script>
    <%}%>
    <%if(so.isNotAuthenticated()){%>
    <link rel="stylesheet" href="${base}/static/plugins/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="${base}/static/plugins/font-awesome/4.5.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="${base}/static/plugins/ionicons/2.0.1/css/ionicons.min.css">
    <link rel="stylesheet" href="${base}/static/css/AdminLTE.min.css">
    <link rel="stylesheet" href="${base}/static/css/skins/skin-blue.min.css">
    <link rel="stylesheet" href="${base}/static/plugins/iCheck/all.css">
    <script src="${base}/static/plugins/jquery/jquery-2.2.3.min.js"></script>
    <script src="${base}/static/plugins/layer/layer.js"></script>
    <script src="${base}/static/plugins/iCheck/icheck.min.js"></script>
    <script src="${base}/static/plugins/bootstrap/js/bootstrap.min.js"></script>
    <script src="${base}/static/js/app.min.js"></script>
    <style>
        .login-page {
            background: url("../static/img/login/bg${randomInt!}.jpg") center center #f6f6f6;
        }
        .lang li a{
            cursor: default;
        }
    </style>
</head>
<body class="hold-transition login-page">
<div class="login-box">
    <div class="login-logo">
        <a><b>${i18n.productNameMiNi}</b>${i18n.productName}</a>
    </div>
    <div class="login-box-body">
        <div style="text-align: right">
            <div class="btn-group">
                <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
                    language <span class="caret"></span>
                </button>
                <ul class="dropdown-menu lang" role="menu">
                    <li data="en_US"><a>English</a></li>
                    <li data="zh_CN"><a>中文简体</a></li>
                </ul>
            </div>
        </div>
        <p class="login-box-msg">${i18n.loginBoxTitle}</p>

        <form action="${base}/account/login" method="post" id="loginFrom">
            <div class="form-group has-feedback">
                <input type="text" autocomplete="off" name="username" id="username" class="form-control" placeholder="${i18n.loginUsernamePlac}">
                <span class="glyphicon glyphicon-envelope form-control-feedback"></span>
            </div>
            <div class="form-group has-feedback">
                <input type="password" autocomplete="off" class="form-control" name="password" id="password" placeholder="${i18n.loginPasswordPlac}">
                <span class="glyphicon glyphicon-lock form-control-feedback"></span>
            </div>
            <%if(isCaptcha){%>
            <div class="form-group input-group">
                <input type="text" autocomplete="off" class="form-control" name="captcha" id="captcha"
                       placeholder="${i18n.loginCaptchaPlac}" style="width: 60%;">
                <img class="input-group-addon" id="yzm" src="${base!}/account/captcha?_=${dateTime()}"
                     style="height: 34px;width: 40%;padding: 0px;">
            </div>
            <%}%>
            <div class="row">
                <div class="col-xs-8">
                    <div class="checkbox icheck">
                        <label>
                            <input type="checkbox" name="rememberMe" value="1" id="rememberMe">${i18n.loginRememberMe}
                        </label>
                    </div>
                </div>
                <div class="col-xs-4">
                    <button type="button" class="btn loginBtn btn-primary btn-block btn-flat">${i18n.loginBtn}</button>
                </div>
            </div>
        </form>
    </div>
</div>
<script>
    $(function () {
        var base = "${base}";

        $('input').iCheck({
            checkboxClass: 'icheckbox_square-blue',
            radioClass: 'iradio_square-blue',
            increaseArea: '20%'
        });

        $("#yzm").click(function () {
            $(this).attr("src", "${base!}/account/captcha?_=" + new Date().getTime());
        })
        document.onkeydown = function (e) {
            var ev = document.all ? window.event : e;
            if (ev.keyCode == 13) {
                doLogin();
            }
        }

        function setCookie(name, value) {
            var Days = 30;
            var exp = new Date();
            exp.setTime(exp.getTime() + Days * 24 * 60 * 60 * 1000);
            document.cookie = name + "=" + escape(value) + ";expires=" + exp.toGMTString()+";path=${base!}";
        }

        function doLogin() {
            var username = $("#username").val();
            var password = $("#password").val();
            if (username.trim() == "" || password.trim() == "") {
                layer.msg("${i18n.loginConfirm}！", {icon: 7, time: 2000});
                return false;
            }
            $.ajax({
                type: "post",
                url: "${base}/account/login",
                data: $("#loginFrom").serialize(),
                dataType: "json",
                success: function (data) {
                    if (data && data.ok) {
                        layer.msg('${i18n.loginSucessMsg}', {icon: 1});
                        setTimeout(function () {
                            window.location.href = base + "/main/index";
                        }, 1000);
                    } else {
                        $('button').attr("disabled", false);
                        layer.msg(data.msg, {icon: 7, time: 2000});
                        $("#yzm").attr("src", "${base!}/account/captcha?_=" + new Date().getTime());
                    }
                }, error: function (status) {
                    $('button').attr("disabled", false);
                    layer.msg("${i18n.AjaxNetworkError}", {icon: 5, time: 1000});
                    console.log(status);
                }
            })
        }

        $('.loginBtn').click(function () {
            doLogin();
        });

        $('.lang li').click(function () {
            var lang= $(this).attr("data");
            setCookie("lang",lang);
            window.location.reload();
        });
    });
</script>
</body>
<%}%>
</html>